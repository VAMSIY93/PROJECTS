W = zeros(8,4);
W(1,:)=[38,76,0,1];
W(2,:)=[190,38,0,1];
W(3,:)=[76,152,0,1];
W(4,:)=[304,114,0,1];
W(5,:)=[266,76,0,1];
W(6,:)=[152,152,0,1];
W(7,:)=[266,190,0,1];
W(8,:)=[114,114,0,1];

C = zeros(8,2);
C(1,:)=[678,429];
C(2,:)=[1138,309];
C(3,:)=[807,663];
C(4,:)=[1464,524];
C(5,:)=[1358,417];
C(6,:)=[1038,652];
C(7,:)=[1369,748];
C(8,:)=[992,542];
%{
C = zeros(6,2);
C(1,:)=[783,522];
C(2,:)=[1269,399];
C(3,:)=[903,766];
C(4,:)=[1652,643];
C(5,:)=[1523,519];
C(6,:)=[1149,767];
%C(7,:)=[1530,894];
%C(8,:)=[1026,644];
%}
O = zeros(1,4);
A = zeros(12,12);
for i=1:2:11
    ind = uint8(i/2);
    A(i,:) = [W(ind,:),O,-C(ind,1)*W(ind,:)];
    A(i+1,:) = [O,W(ind,:),-C(ind,2)*W(ind,:)];
end
A(12,:) = [W(7,:),O,-C(7,1)*W(7,:)];

[U,D,V] = svd(A,0);
M = V(:,end);
m = reshape(M,4,3)';
gamma = sqrt(sumsqr(M(9:11,1)));

M = M/gamma;
%{
if(M(12,1)>=0)
    sin=1;
else
    sin=-1;
end
%}
sin=1;

q1 = M(1:3,1);
q2 = M(5:7,1);
q3 = M(9:11,1);
q4 = [M(4,1);M(8,1);M(12,1)];

R = zeros(3);
T = zeros(3,1);
R(3,:) = sin*M(9:11,1)';
T(3,1) = sin*M(12,1);

ox = q1'*q3;
oy = q2'*q3;

fx = sqrt(q1'*q1-(ox^2));
fy = sqrt(q2'*q2-(oy^2));

FL = [969.2872,968.1613];
PP = [969.2164,552.4530];

R(1,:) = sin*(ox*M(9:11,1)'-M(1:3,1)')/fx;
R(2,:) = sin*(oy*M(9:11,1)'-M(5:7,1)')/fy;

T(1,1) = sin*(ox*M(12,1)-M(4,1))/fx;
T(2,1) = sin*(oy*M(12,1)-M(8,1))/fy;

%[U1,D1,V1] = svd(R);
%R = U1*V1';
%{
m = zeros(3,4);
m(1,:)=M(1:4,1)';
m(2,:)=M(5:8,1)';
m(3,:)=M(9:12,1)';
%}